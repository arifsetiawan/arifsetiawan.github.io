
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Resizing MongoDB Data Disk - Infinite | Squares</title>
  <meta name="author" content="Nurul Arif Setiawan">

  
  <meta name="description" content="I received a message saying the are issue in our Node.js app running on Azure: Can&rsquo;t take a write lock while out of disk space. The issue is &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.infinitesquares.net/blog/2014/09/17/resizing-mongodb-data-disk">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Infinite | Squares" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-45905282-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Infinite | Squares</a></h1>
  
    <h2>Art of code and more</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.infinitesquares.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/categories">Categories</a></li>
  <li><a href="http://orchidreader.com/" target="_blank">Orchid Reader</a></li>
  <li><a href="http://cymbidium.co.id/" target="_blank">Cymbidium</a></li>
  <li><a href="http://www.jepret.in/" target="_blank">Jepret Cloud</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Resizing MongoDB Data Disk</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-09-17T06:19:00+07:00" pubdate data-updated="true">Sep 17<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I received a message saying the are issue in our Node.js app running on Azure: Can&rsquo;t take a write lock while out of disk space. The issue is clear enough: our MongoDB data disk is run out. I will outlined steps how we can resize MongoDB data disk. Well, it&rsquo;s not actually that hard. Simplified steps are :</p>

<!-- more -->


<ul>
<li>Prepare bigger data disk</li>
<li>Copy all old MongoDB data from old disk to new one</li>
<li>Update MongoDB config</li>
<li>Restart MongoDB service</li>
</ul>


<p>Start with preparing bigger disk space. On Azure, follow this tutorial on <a href="http://azure.microsoft.com/en-us/documentation/articles/virtual-machines-linux-how-to-attach-disk/">How to Attach a Data Disk to a Linux Virtual Machine</a></p>

<p>Then create MongoDB data folder and make sure to change ownership of the folder to mongod or you will have write access issue.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir /mongodata
</span><span class='line'>$ sudo chown -R mongod:mongod /mongodata</span></code></pre></td></tr></table></div></figure>


<p>Copy all old data to new folder</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo cp -r /oldmongodata /mongodata</span></code></pre></td></tr></table></div></figure>


<p>Use option <code>-v</code> if you want to see the copying progree, or if you forget to do that use this command</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ watch ls -lah /mongodata</span></code></pre></td></tr></table></div></figure>


<p>When copy completed, open MongoDb config file (usually in <code>/etc/mongod.conf</code>) and update the dbpath to the new data folder.</p>

<p>Restart the service</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo service mongod start</span></code></pre></td></tr></table></div></figure>


<p>While the resizing MongoDB data disk is quite simple, disk run out issue should not be happening during production server deployment. One possible approach to minimize the risk is to create reporting daemon (or use third party service) to monitor server stats.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Nurul Arif Setiawan</span></span>

      








  


<time datetime="2014-09-17T06:19:00+07:00" pubdate data-updated="true">Sep 17<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/mongodb/'>MongoDB</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://blog.infinitesquares.net/blog/2014/09/17/resizing-mongodb-data-disk/" data-via="ken121f" data-counturl="http://blog.infinitesquares.net/blog/2014/09/17/resizing-mongodb-data-disk/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/09/16/ubuntu-server-setup/" title="Previous Post: Ubuntu server setup">&laquo; Ubuntu server setup</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/09/20/know-your-npm/" title="Next Post: Know your npm">Know your npm &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>I'm Arif Setiawan, primarily C++ and Javascript (Node.js) Developer. Currently work as CTO at <a href="http://dycode.co.id/">Dycode</a></p>
  <p>My upcoming product : <a href="http://orchidreader.com">OrchidReader</a></p>
  <p>I developed backend service for <a href="http://www.cymbidium.co.id/">Cymbidium</a>, a document archiving and processing solution.<br>And <a href="http://www.jepret.in/">Jepret Cloud</a>, a platfom for photo collecting and management<p>
  <p>I worked with many languages: C, C++, C#, Javascript, PHP, HTML, CSS, Objective-C, Java and work on various platforms: Qt, OpenCV, .NET, iOS, Android and Node.js.<p>
  <p>I also have interest in Machine Learning, Image Processing, and Big Data Processing and Analytics<p>
</section>
<section class="twitter2">
  <h1>
    <a href="https://twitter.com/ken121f" target="_blank">
      <img src="/images/logo.png" width="32" height="32">
      ken121f
    </a>
  </h1>
</section><section class="github2">
  <h1>
    <a href="https://github.com/arifsetiawan" target="_blank">
      <img src="/images/github_64.png" width="32" height="32">
      arifsetiawan
    </a>
  </h1>
</section><section class="linkedin">
  <h1>
    <a href="https://www.linkedin.com/pub/nurul-arif-setiawan/43/b71/311" target="_blank"><img src="/images/linkedin_64.png" width="32" height="32">Arif Setiawan</a>
  </h1>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/11/13/issues-on-using-iisnode-on-windows-7/">Issues on Using Iisnode on Windows 7</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/01/friendly-nodejs-error-message/">Friendly Node.js Error Message</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/30/makefile-phony/">Makefile .PHONY</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/21/resumable-download-and-upload-with-qt/">Resumable Download and Upload With Qt</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/21/flatten-node-modules/">Flatten Node_modules</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Nurul Arif Setiawan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'infinitesquares';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.infinitesquares.net/blog/2014/09/17/resizing-mongodb-data-disk/';
        var disqus_url = 'http://blog.infinitesquares.net/blog/2014/09/17/resizing-mongodb-data-disk/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
